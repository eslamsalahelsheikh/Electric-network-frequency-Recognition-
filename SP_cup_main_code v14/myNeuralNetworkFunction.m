function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 14-Jan-2016 23:58:54.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 38xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 9xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [-54.3501041426329;-68.4219885615311;-56.4476456983152;-53.6981899366146;-54.3501041426322;-3.90043331547644;-3.49367305833875;-3.91079497723798;-3.284745055354;-48.9449030696427;-43.9203630142094;-74.8596668338667;-31.4682796189197;-56.3079533471606;-54.1376012617477;-44.2799088590091;-70.5834525312665;-75.7892057017319;-13.2750943744169;-6.12038965472842;-7.97792911955547;-19.3877300356074;-24.5261753024373;-4.77846993339792;-19.3549757165444;-10.3466364431585;-4.26441577087882;-15.0674946417278;-57.0837169689261;-56.0492008537371;-54.6851211189743;-69.7591034971114;-28.3210258622771;-47.2232567570097;-47.9548897339562;-54.7859943755884;-69.829799365163;-17.7837148921967];
x1_step1_gain = [0.0133131018386791;0.0118749340099931;0.0128375026066734;0.013406576524026;0.0133131018386791;0.019249197873192;0.0275668916601787;0.019247278402962;0.0305547539764495;0.0134277840918454;0.0138965741755566;0.0127120153550447;0.0174134061657178;0.0141369115448688;0.0146150663170565;0.0147880918774369;0.0117244666485656;0.012068752509643;0.0219307742803951;0.0188465195661943;0.0185223037365864;0.0167521402693853;0.0164910824859425;0.0197757427970572;0.0167567375217753;0.025245121876907;0.0236661036201927;0.0173811032057938;0.0127875583973645;0.0131073608714429;0.0132194103056659;0.011781400577637;0.0177005600916973;0.0151757881557656;0.0161929216807779;0.0129210656821249;0.0121844099096713;0.0192071975657909];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.2662847052468755;-1.3760225876522156;-0.85530399265911017;-0.70220462357054325;-0.0031865569307870114;-0.015463544621341196;-0.6408634207996029;-0.67958759534730095;-1.2199886584481408;1.4029316526386049];
IW1_1 = [-0.35707580942389555 -0.13785184168511896 0.31312173401279925 -0.21798594111020878 -0.37391710611540102 0.31847389323492342 0.20201249742551669 -0.40378280468766659 -0.75074735771038226 0.13966100826340327 0.37269106205075819 0.46352761379431562 0.48018188289831742 -0.80762803400986694 -0.38681652625520718 -0.7734797177912609 -0.76266215134277437 -0.015826818934475462 -0.032977048353174047 -0.64037493661964828 0.5728536571686802 1.0406443290675511 1.4728381633305514 0.32231204840258887 0.072260032218525838 -0.50803267003138686 0.455497929092545 0.48118504186123434 -1.0769820232863236 -0.22202254555650072 0.16898343437570573 -0.43573947441306388 0.54205296337566211 -0.66604660781094771 -0.27245949876503339 -0.76473396519098569 -0.80890898829012781 -0.28270080118795093;0.53540172278956133 0.050182594990124618 0.28560530270520645 0.33946622993412662 0.32874905319251357 -0.0041815617757636992 0.0052403443851625243 0.62503661247145048 0.37200563948429227 0.21435405878078356 0.29420099058243737 -0.25714739080249432 -0.62591779490744048 -0.80010491622304625 -0.63447926932139387 -0.55589181458019832 0.93635052448789435 0.84228647029299686 0.95091717508196683 -0.46432608736271952 -0.081848659745801494 -0.30753181006025981 0.057288856792535855 0.13686633123369721 0.34085232054355386 0.63086983863354662 -0.22523165012570959 0.37690180585991495 0.21741203718031651 0.18868568322389304 -0.049368894993877421 -0.5960318520874146 -0.41210169082735837 -0.74181566362272622 -0.8931313147863037 0.10786320643247227 0.63997994924931823 -1.2766791225008651;-0.4627093038195384 0.41193598587766628 0.17083510442467714 -0.4149435010239283 -0.55275307951238861 0.28510243593818813 -0.34559438052112235 -0.37412079439434714 0.09304501994049437 0.40750288057470524 0.22548640335372316 -0.14763868086576989 -0.08300247225413851 0.1693396124167782 0.20691678393310473 -0.43428661395403495 -0.32336765452556265 -0.2315065359638919 0.10002970235970619 0.24473867348549858 -0.059757764286600609 -0.11572814740904755 0.12763766413627278 0.26133589426966519 -0.52250834711420546 0.15951569780682359 -0.16413308344411265 -0.034247493411321925 0.12400530985463452 -0.70346601738379511 -0.62841716671284775 0.32488712067225373 0.31555877238064634 0.12556854080947646 -0.31953305609232213 0.025521219229148434 -0.19129076567842251 0.16966870187676569;0.3709928880883348 0.016964390653220456 0.49419211654683143 -0.16736246176684902 -0.22771007929470391 0.013340990595599934 -0.2221378344646644 -0.033511802917182601 -0.10805469706665617 0.010809878143224108 0.27039215505791314 -0.15074634666543815 -0.15867489615475344 -0.33190007126783355 -0.58144977779215712 0.12257686498510512 -0.10902619418545777 0.67262165895293602 -0.50357613178846783 -0.36525460392097814 0.40491512055446532 0.97465943881403172 -0.18710754181928166 0.56307591733178852 -0.12634967120582935 0.61366559555165101 -0.27716961661291312 -0.13107384432490282 -0.029112689450017295 -0.32224577403160498 -0.19994831818267403 -0.20534125555384347 0.17704164304804912 -0.90820701857010899 -0.19626836655324179 0.18168235227954355 0.72570511499782453 0.29430144461291857;0.22382941275598897 -0.11038625585146174 -0.25592850413819579 -0.092385074207908979 -0.28137465198143669 0.072509547195473284 -0.35959547234734424 -0.43695079911145496 -0.094556620116970705 -0.017151176270554926 -0.18688723726931228 0.014107754226739544 -0.30785612109976684 -0.65806073601574355 1.1257881374331573 1.2102075914550134 0.77697267071471099 -0.40844865523397661 -0.080226159287350135 -0.50074928407066033 -0.43349509505122963 0.58954370803078171 0.65262946465651728 0.0760030984692176 0.066119278096195555 0.25562386362761336 0.73183244923213397 -0.060372505107457494 0.4715351683911958 0.006767979519199321 -0.51757371463679291 -0.38418073929488722 -0.53672435957135256 -0.16258172630994452 1.0076388032291084 1.0816607146997383 0.71883327366245708 -1.0421680494777723;0.29457374611354609 -0.4296442703355518 -0.2895118216845225 0.17165470801065183 0.52339359315932676 0.25425491160277958 -0.25845406550473804 -0.44365074471713067 -0.15529476110401647 -0.4750981980050627 -0.1425203302229277 -0.36931755819781581 -0.20325839501740534 0.17861766403781548 0.087810905182609006 0.39058897909178864 0.040876322827268545 -0.017684237470604214 -0.28483361614595903 -0.064960034341889766 -0.22342017018781815 -0.01695174918533594 -0.036915294505962967 -0.19872703755095744 -0.31094057739776465 -0.29967585297219257 0.31899582507960494 0.16040621387048884 -0.063188796117759627 0.82508670451464505 0.58317593574320703 -0.38028680058596409 -0.54071018886171052 0.27919833347828377 -0.14804436572740109 -0.14805456394597055 -0.23537343910016764 -0.10801926747380472;-0.67127893968499697 -0.31533700244856683 -0.29612652946429446 -0.26948019754924019 -0.62952349822809706 0.083822868612298651 0.16409805546919284 -0.078250838846612603 0.18211624991285061 0.27677561599398809 0.36306057165939515 -0.30764078332729455 -0.035466117725534319 -0.31378971828048546 -0.090513431187955989 -0.25275573263959122 -0.21482041597295312 -0.31172514958167752 0.10304824158710443 -0.32260148918577441 0.52642542547662874 -0.032612342755104787 0.26920542446925294 0.21740223265198325 0.0057877186844701826 0.2265294680713873 0.078262785310743987 0.18455980638544242 -0.33475539383489072 -0.67530335234462724 -0.38823604330969452 0.044620619985339172 -0.021170530327576601 0.31568204301441377 -0.31714225247599714 -0.35345726762037732 -0.33802089496657495 0.2802193651665264;-0.35037933004821542 0.19923791754691839 0.7136919961376631 -0.01434372741100632 0.074483210539015049 -0.31775511187913363 0.38630694161788709 0.19537824588944425 0.58755419483311178 0.40593724899981537 0.59519834913624603 0.86689824955526118 -0.34749958358576283 -0.2476457118147492 0.46354186675468162 0.82170540086190635 0.63325720942394259 0.43574291981063074 -0.24119457072561407 0.200159530510712 0.10296944981864931 -0.59828882268916561 -0.054303245159049773 0.088862729221683895 0.77333658628331359 -0.19845260026149958 0.037003778562924208 -0.77463963295302718 0.81603876668986142 -0.24963434321936703 -0.20572888147916585 0.45057892953620454 -1.0013031676209379 -0.40283743691555951 0.42900075287889322 0.67809521372225234 0.57685730384989609 -0.82467321033590613;-0.60376900169446424 -0.53008280301954802 -0.064157542900448311 -0.28735293721867716 -0.22109240469477046 -0.11715468336640651 -0.26437391623468021 0.29222231913137542 -0.29356356544839646 -0.26147943677329366 -0.55002181634712122 -0.66350476673507275 0.44213966988184356 0.68449316968868557 -0.1545292864110237 -0.64517625321425309 -0.78817229585348703 -0.39710392863118615 0.78582359524009915 0.75349353938506225 0.19474430925329361 -0.52109598707467519 -0.92055642786756553 -0.080334330159772538 -0.039865673944887936 0.58577824011609325 0.10216029114379888 0.12860594756169991 -0.32959258523720519 -0.26391827773586812 -0.57764202843208878 -0.32049895672663276 0.73481107103516741 0.77403908680813183 -0.37604746383613863 -1.1262199732668059 -0.8089061775798696 0.74115036885624552;0.20671403349624226 -0.012268328169269675 -0.6398776346138606 0.060402191967580676 -0.15690104658856305 -0.31453128260655527 0.29355631018531653 -0.20565232882431889 -0.23468829491892634 -0.55848239770137009 0.0075462942246958195 0.45925602277691691 -0.42616883173226211 -0.37752844831755783 -0.48669164801940845 -0.42782990166969231 -0.44496688222891839 -0.18875684369813681 0.25886019305466662 0.026453464337573594 0.12794545241766872 -0.18669818926632606 -0.31978876519950572 0.071135009534273916 -0.32735568741862486 0.047706575168638674 0.5388943677661393 -0.3687848501813204 0.053990516975680164 0.060725466588623947 -0.23883706537252639 0.5134780110049888 -0.23522724750931734 -0.77738240300784456 -0.28114236719822561 0.11186745037320137 0.08324302022251448 -0.21907730003289977];

% Layer 2
b2 = [1.0226819343420688;0.80855487183662744;-0.33521103221609094;0.36153902373949998;-0.17881935441560809;0.24129245713927991;0.63246603547499081;-0.31314414450447259;0.13661821610064212];
LW2_1 = [-1.1568691691067046 1.2028571646220105 -1.8005243564541011 0.48199210591020464 0.39659878468289378 1.3956851985747907 -0.36499279630586245 -0.78114855811255901 -1.3371459653974282 -0.61412459388199336;-2.3103923204328098 -0.15270244196700361 0.98915831645390528 -0.899229308158218 0.53647328339314826 0.13034058215097502 -0.26678686931963042 0.39344016299541745 -0.62864644537401004 0.58607345351243856;0.89363719338653314 3.1682298363939676 -0.79801789755002706 -0.63225299981790317 -0.46355668015562701 -0.10484000723441325 -1.7300083347255366 -1.0161071691711143 -1.084874521381358 -0.37117264933215177;0.068411383537585982 0.48101682741674862 0.52497953777691309 -1.1655057145758725 0.4793049041595584 -0.68366346223929397 1.1164824776873863 -0.77441097561180183 1.6824846804734062 -0.31519187130130405;-0.47923699382676088 0.35069944061722669 0.93722510650460567 -0.43166211197419635 -2.5986645845860989 -0.83749581299250497 0.20526856863953827 -1.1013131622858687 2.5209996625844178 -0.4901114196213604;1.1124269396402335 -0.28810049502064572 -0.28201273421568523 -0.1338268148504087 2.2643657283318515 -0.40842036097509288 0.82830806498483711 -0.96336259986933537 0.0099594207622683284 -1.0554134325987938;-0.411537470656542 0.10045005376695089 1.7019316128574047 1.0249422393964973 0.026881929768147791 -0.59295149363954147 0.88319480754236579 0.019884901008479235 -0.26577807555366773 0.98006527502820306;1.6156046947763911 0.85486938452888228 0.74577831700070984 0.56623154402402576 -0.10012902280806821 -1.4028931597393801 0.72702581415683387 2.1387076909642175 -1.6470815099428417 0.30070012999990386;0.42844414781374729 -0.99385214123345067 -1.2184593967379374 0.38599689464057085 -0.44932075079813383 0.29995845216818084 -2.1639671879070481 0.17116230495653625 -0.72863204682854998 0.78779892071162883];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
